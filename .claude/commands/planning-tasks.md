# 規則：從 PRD 規劃任務清單

## 目標

指導 AI 助手根據現有的產品需求文件 (PRD) 創建詳細的、逐步的任務規劃，並使用 Claude Code 的 Todo 系統來追蹤進度。此指令會分析 PRD 並產生結構化的任務清單，同時建立驗收條件檔案。

## 流程

1.  **接收 PRD 參考：** 使用者向 AI 指出特定的 PRD 檔案或提供 PRD 所在目錄路徑
2.  **分析 PRD：** AI 讀取並分析指定 PRD 的功能需求、使用者故事和其他部分
3.  **撰寫 Gherkin 驗收條件：** 使用 Gherkin 語法撰寫整個 PRD 的高階驗收條件，並儲存為 `acceptance.feature` 檔案在 PRD 相同目錄
4.  **階段 1：產生父任務：** 根據 PRD 分析和 Gherkin 驗收條件，產生實現功能所需的主要高層級任務（約 5-7 個）
5.  **使用 Todo 系統：** 將產生的任務加入到 Claude Code 的 Todo 清單中，設定適當的優先級
6.  **等待確認：** 向使用者展示高層級任務，詢問是否需要分解為更詳細的子任務
7.  **階段 2：產生子任務（可選）：** 如果使用者需要，將每個父任務分解為更小的、可操作的子任務
8.  **識別相關檔案：** 根據任務和 PRD，識別需要創建或修改的潛在檔案
9.  **儲存實作計畫：** 將完整的任務清單、技術細節和檔案追蹤資訊儲存為 `implementation-plan.md` 檔案在 PRD 相同目錄

## Todo 任務格式

在 Claude Code 的 Todo 系統中，任務應該包含：

- **任務內容**：清晰描述要完成的工作
- **優先級**：
  - `high`：核心功能實作
  - `medium`：輔助功能或整合工作
  - `low`：優化或文檔工作
- **狀態**：
  - `pending`：尚未開始
  - `in_progress`：正在進行（一次只能有一個）
  - `completed`：已完成

## 任務範例

基於 PRD 分析，Todo 清單可能包含：

```
1. [高優先級] 實作資料模型和資料庫結構
2. [高優先級] 建立核心 API 端點
3. [中優先級] 開發前端 UI 組件
4. [中優先級] 實作狀態管理邏輯
5. [低優先級] 加入錯誤處理和驗證
6. [高優先級] 執行驗收測試
```

## Gherkin 驗收條件檔案

驗收條件應使用 Gherkin 語法撰寫，並儲存為 `acceptance.feature` 檔案在與 PRD 相同的目錄中：

- **檔案位置：** 與 PRD 相同目錄（例如：`/spec/YYYYMMDD-[功能SLUG]/acceptance.feature`）
- **檔案格式：** 

```gherkin
Feature: [功能名稱]
As a [使用者角色]
I want to [想要做的事]
So that [期望的結果]

Scenario: [場景名稱]
Given [前置條件]
When [執行動作]
Then [預期結果]
And [額外驗證]

Scenario: [另一個場景名稱]
Given [前置條件]
When [執行動作]
Then [預期結果]

# 可以包含多個 Scenario 來涵蓋不同的使用情境
# 確保涵蓋核心功能和關鍵使用者流程
```

這個檔案將用於後續的驗收測試執行。

## 相關檔案追蹤

在規劃任務時，應同時識別：

- 需要創建的新檔案
- 需要修改的現有檔案
- 測試檔案位置
- 配置檔案更新

## 實作順序建議

1. **實用函數**：輔助函數和計算
2. **核心服務**：業務邏輯和資料處理
3. **API 整合**：外部服務通訊
4. **狀態管理**：應用程式狀態邏輯
5. **UI 組件**：使用者介面元素
6. **整合測試**：驗收條件執行

## 驗收執行方式

驗收測試可透過以下方式執行：

### UI 操作驗收
- 當涉及使用者介面操作時（點擊、填寫表單、頁面導航）
- 使用適合的工具自動化執行瀏覽器操作
- 驗證頁面元素、內容變化、狀態更新

### 指令執行驗收
- 當涉及命令列操作或系統行為時
- 透過終端指令執行相關命令
- 檢查執行結果是否符合預期

## 使用方式

1. 使用者提供 PRD 檔案路徑
2. AI 分析 PRD 並產生任務規劃
3. 建立 `acceptance.feature` 檔案在 PRD 相同目錄
4. 將任務加入 Todo 系統
5. 建立 `implementation-plan.md` 檔案記錄詳細的實作計畫
6. 開發者按照 Todo 清單逐步完成實作
7. 每完成一個任務就標記為完成
8. 最後執行 `acceptance.feature` 中的驗收測試確認功能完整性

## 注意事項

- 專注於可執行的具體任務
- 避免過度分解任務（保持在合理的粒度）
- 確保任務之間的依賴關係清晰
- 使用 Todo 系統的優勢來即時追蹤進度
- 驗收條件檔案 (`acceptance.feature`) 必須儲存在與 PRD 相同的目錄中
- 實作計畫檔案 (`implementation-plan.md`) 包含完整的任務細節和技術資訊，也儲存在與 PRD 相同目錄
- Todo 清單用於追蹤進度，驗收條件檔案用於最終驗證，實作計畫檔案用於記錄技術細節